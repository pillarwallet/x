import{b8 as l,b9 as c,b3 as p,b1 as i,b7 as t,ba as d,aG as g,b0 as n,b4 as o,bb as m}from"./main-CDKDnvW7.js";import{telegramActions as r}from"./telegramSlice-BqfObn-v.js";const f=async e=>{const a=new AbortController,s=l.post("https://exolix.com/api/v2/telegram-user/start",e,{signal:a.signal});return s[c]=()=>a.abort(),(await s).data};function*D(){try{yield p([i(y),t(u),t(U)])}catch(e){console.error(e)}}function*y(){try{(yield d(g))&&window&&window.Telegram&&window.Telegram.WebApp&&window.Telegram.WebApp.initData&&(yield n(r.setIsTelegramApp()))}catch(e){console.error(e)}}function*u(){yield o(r.setIsTelegramApp,T)}function*T(){try{const e=window.Telegram.WebApp;yield e.ready(),yield e.expand(),yield e.enableClosingConfirmation();const a={telegramId:e.initDataUnsafe.user.id,firstName:e.initDataUnsafe.user.first_name};e.initDataUnsafe.user.username&&(a.username=e.initDataUnsafe.user.username),e.initDataUnsafe.user.last_name&&(a.lastName=e.initDataUnsafe.user.last_name),e.initDataUnsafe.user.language_code&&(a.languageCode=e.initDataUnsafe.user.language_code),e.initDataUnsafe.start_param&&(a.startTag=e.initDataUnsafe.start_param),yield n(r.handleTelegramUser(a))}catch(e){console.error(e)}}function*U(){yield o(r.handleTelegramUser,b)}function*b(e){try{const a=yield i(f,e.payload);yield n(r.handleTelegramUserSuccess(a)),yield n(m.setApiToken({apiToken:a.apiToken}))}catch(a){const s=a.response&&a.response.data?a.response.data.error||a.response.data.message:JSON.stringify(a);yield n(r.handleTelegramUserFailure(s)),console.error(a)}}export{U as handleTelegramUserSaga,b as handleTelegramUserWorker,u as initTelegramAppSaga,T as initTelegramAppWorker,D as telegramSaga};
