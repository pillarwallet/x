import{c as j,a_ as it,a$ as ht,b0 as se,b1 as Se,b2 as vt,b3 as ot,b4 as pt,b5 as ye,b6 as mt,b7 as wt}from"./main-CDKDnvW7.js";import{e as Ie}from"./events-Jbtv7R_f.js";import{b as oe}from"./browser-Dc9KYRY-.js";import{c as yt}from"./_commonjs-dynamic-modules-TDtrdbi3.js";import{r as gt}from"./___vite-browser-external_commonjs-proxy-MvlAxKD_.js";import{c as _t}from"./ratesSlice-DmdeARD_.js";import{c as bt}from"./transactionSlice-BLjUsgVM.js";var Ue={},ue={},ee={},le={},Me={exports:{}};(function(n,e){(function(t){function r(c){var u=c&&c.Promise||t.Promise,p=c&&c.XMLHttpRequest||t.XMLHttpRequest;return function(){var y=Object.create(t,{fetch:{value:void 0,writable:!0}});return function(m,i){i(e)}(this,function(m){var i=typeof y<"u"&&y||typeof self<"u"&&self||typeof i<"u"&&i,s={searchParams:"URLSearchParams"in i,iterable:"Symbol"in i&&"iterator"in Symbol,blob:"FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in i,arrayBuffer:"ArrayBuffer"in i};function _(a){return a&&DataView.prototype.isPrototypeOf(a)}if(s.arrayBuffer)var O=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],k=ArrayBuffer.isView||function(a){return a&&O.indexOf(Object.prototype.toString.call(a))>-1};function h(a){if(typeof a!="string"&&(a=String(a)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(a)||a==="")throw new TypeError("Invalid character in header field name");return a.toLowerCase()}function d(a){return typeof a!="string"&&(a=String(a)),a}function w(a){var b={next:function(){var R=a.shift();return{done:R===void 0,value:R}}};return s.iterable&&(b[Symbol.iterator]=function(){return b}),b}function g(a){this.map={},a instanceof g?a.forEach(function(b,R){this.append(R,b)},this):Array.isArray(a)?a.forEach(function(b){this.append(b[0],b[1])},this):a&&Object.getOwnPropertyNames(a).forEach(function(b){this.append(b,a[b])},this)}g.prototype.append=function(a,b){a=h(a),b=d(b);var R=this.map[a];this.map[a]=R?R+", "+b:b},g.prototype.delete=function(a){delete this.map[h(a)]},g.prototype.get=function(a){return a=h(a),this.has(a)?this.map[a]:null},g.prototype.has=function(a){return this.map.hasOwnProperty(h(a))},g.prototype.set=function(a,b){this.map[h(a)]=d(b)},g.prototype.forEach=function(a,b){for(var R in this.map)this.map.hasOwnProperty(R)&&a.call(b,this.map[R],R,this)},g.prototype.keys=function(){var a=[];return this.forEach(function(b,R){a.push(R)}),w(a)},g.prototype.values=function(){var a=[];return this.forEach(function(b){a.push(b)}),w(a)},g.prototype.entries=function(){var a=[];return this.forEach(function(b,R){a.push([R,b])}),w(a)},s.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function l(a){if(a.bodyUsed)return u.reject(new TypeError("Already read"));a.bodyUsed=!0}function f(a){return new u(function(b,R){a.onload=function(){b(a.result)},a.onerror=function(){R(a.error)}})}function o(a){var b=new FileReader,R=f(b);return b.readAsArrayBuffer(a),R}function v(a){var b=new FileReader,R=f(b);return b.readAsText(a),R}function A(a){for(var b=new Uint8Array(a),R=new Array(b.length),U=0;U<b.length;U++)R[U]=String.fromCharCode(b[U]);return R.join("")}function S(a){if(a.slice)return a.slice(0);var b=new Uint8Array(a.byteLength);return b.set(new Uint8Array(a)),b.buffer}function P(){return this.bodyUsed=!1,this._initBody=function(a){this.bodyUsed=this.bodyUsed,this._bodyInit=a,a?typeof a=="string"?this._bodyText=a:s.blob&&Blob.prototype.isPrototypeOf(a)?this._bodyBlob=a:s.formData&&FormData.prototype.isPrototypeOf(a)?this._bodyFormData=a:s.searchParams&&URLSearchParams.prototype.isPrototypeOf(a)?this._bodyText=a.toString():s.arrayBuffer&&s.blob&&_(a)?(this._bodyArrayBuffer=S(a.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(a)||k(a))?this._bodyArrayBuffer=S(a):this._bodyText=a=Object.prototype.toString.call(a):this._bodyText="",this.headers.get("content-type")||(typeof a=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):s.searchParams&&URLSearchParams.prototype.isPrototypeOf(a)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s.blob&&(this.blob=function(){var a=l(this);if(a)return a;if(this._bodyBlob)return u.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return u.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return u.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var a=l(this);return a||(ArrayBuffer.isView(this._bodyArrayBuffer)?u.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):u.resolve(this._bodyArrayBuffer))}else return this.blob().then(o)}),this.text=function(){var a=l(this);if(a)return a;if(this._bodyBlob)return v(this._bodyBlob);if(this._bodyArrayBuffer)return u.resolve(A(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return u.resolve(this._bodyText)},s.formData&&(this.formData=function(){return this.text().then(I)}),this.json=function(){return this.text().then(JSON.parse)},this}var J=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function z(a){var b=a.toUpperCase();return J.indexOf(b)>-1?b:a}function M(a,b){if(!(this instanceof M))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');b=b||{};var R=b.body;if(a instanceof M){if(a.bodyUsed)throw new TypeError("Already read");this.url=a.url,this.credentials=a.credentials,b.headers||(this.headers=new g(a.headers)),this.method=a.method,this.mode=a.mode,this.signal=a.signal,!R&&a._bodyInit!=null&&(R=a._bodyInit,a.bodyUsed=!0)}else this.url=String(a);if(this.credentials=b.credentials||this.credentials||"same-origin",(b.headers||!this.headers)&&(this.headers=new g(b.headers)),this.method=z(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.signal=b.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&R)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(R),(this.method==="GET"||this.method==="HEAD")&&(b.cache==="no-store"||b.cache==="no-cache")){var U=/([?&])_=[^&]*/;if(U.test(this.url))this.url=this.url.replace(U,"$1_="+new Date().getTime());else{var L=/\?/;this.url+=(L.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}M.prototype.clone=function(){return new M(this,{body:this._bodyInit})};function I(a){var b=new FormData;return a.trim().split("&").forEach(function(R){if(R){var U=R.split("="),L=U.shift().replace(/\+/g," "),X=U.join("=").replace(/\+/g," ");b.append(decodeURIComponent(L),decodeURIComponent(X))}}),b}function C(a){var b=new g,R=a.replace(/\r?\n[\t ]+/g," ");return R.split("\r").map(function(U){return U.indexOf(`
`)===0?U.substr(1,U.length):U}).forEach(function(U){var L=U.split(":"),X=L.shift().trim();if(X){var me=L.join(":").trim();b.append(X,me)}}),b}P.call(M.prototype);function D(a,b){if(!(this instanceof D))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');b||(b={}),this.type="default",this.status=b.status===void 0?200:b.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in b?b.statusText:"",this.headers=new g(b.headers),this.url=b.url||"",this._initBody(a)}P.call(D.prototype),D.prototype.clone=function(){return new D(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},D.error=function(){var a=new D(null,{status:0,statusText:""});return a.type="error",a};var Z=[301,302,303,307,308];D.redirect=function(a,b){if(Z.indexOf(b)===-1)throw new RangeError("Invalid status code");return new D(null,{status:b,headers:{location:a}})},m.DOMException=i.DOMException;try{new m.DOMException}catch{m.DOMException=function(b,R){this.message=b,this.name=R;var U=Error(b);this.stack=U.stack},m.DOMException.prototype=Object.create(Error.prototype),m.DOMException.prototype.constructor=m.DOMException}function N(a,b){return new u(function(R,U){var L=new M(a,b);if(L.signal&&L.signal.aborted)return U(new m.DOMException("Aborted","AbortError"));var X=new p;function me(){X.abort()}X.onload=function(){var K={status:X.status,statusText:X.statusText,headers:C(X.getAllResponseHeaders()||"")};K.url="responseURL"in X?X.responseURL:K.headers.get("X-Request-URL");var we="response"in X?X.response:X.responseText;setTimeout(function(){R(new D(we,K))},0)},X.onerror=function(){setTimeout(function(){U(new TypeError("Network request failed"))},0)},X.ontimeout=function(){setTimeout(function(){U(new TypeError("Network request failed"))},0)},X.onabort=function(){setTimeout(function(){U(new m.DOMException("Aborted","AbortError"))},0)};function ft(K){try{return K===""&&i.location.href?i.location.href:K}catch{return K}}X.open(L.method,ft(L.url),!0),L.credentials==="include"?X.withCredentials=!0:L.credentials==="omit"&&(X.withCredentials=!1),"responseType"in X&&(s.blob?X.responseType="blob":s.arrayBuffer&&L.headers.get("Content-Type")&&L.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(X.responseType="arraybuffer")),b&&typeof b.headers=="object"&&!(b.headers instanceof g)?Object.getOwnPropertyNames(b.headers).forEach(function(K){X.setRequestHeader(K,d(b.headers[K]))}):L.headers.forEach(function(K,we){X.setRequestHeader(we,K)}),L.signal&&(L.signal.addEventListener("abort",me),X.onreadystatechange=function(){X.readyState===4&&L.signal.removeEventListener("abort",me)}),X.send(typeof L._bodyInit>"u"?null:L._bodyInit)})}N.polyfill=!0,i.fetch||(i.fetch=N,i.Headers=g,i.Request=M,i.Response=D),m.Headers=g,m.Request=M,m.Response=D,m.fetch=N,Object.defineProperty(m,"__esModule",{value:!0})}),{fetch:y.fetch,Headers:y.Headers,Request:y.Request,Response:y.Response,DOMException:y.DOMException}}()}n.exports=r})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof j<"u"?j:j)})(Me,Me.exports);var xt=Me.exports,H={};H.endianness=function(){return"LE"};H.hostname=function(){return typeof location<"u"?location.hostname:""};H.loadavg=function(){return[]};H.uptime=function(){return 0};H.freemem=function(){return Number.MAX_VALUE};H.totalmem=function(){return Number.MAX_VALUE};H.cpus=function(){return[]};H.type=function(){return"Browser"};H.release=function(){return typeof navigator<"u"?navigator.appVersion:""};H.networkInterfaces=H.getNetworkInterfaces=function(){return{}};H.arch=function(){return"javascript"};H.platform=function(){return"browser"};H.tmpdir=H.tmpDir=function(){return"/tmp"};H.EOL=`
`;H.homedir=function(){return"/"};var V={};Object.defineProperty(V,"__esModule",{value:!0});V.DeferredPromise=V.throwIfError=void 0;function St(n){var e,t,r,c,u,p;if(n.message!==void 0)throw new Error(n.message);if(n.next===void 0&&((t=(e=n)===null||e===void 0?void 0:e.meta)===null||t===void 0?void 0:t.uuid)===void 0&&((c=(r=n)===null||r===void 0?void 0:r.application)===null||c===void 0?void 0:c.uuidv4)===void 0&&((p=(u=n)===null||u===void 0?void 0:u.error)===null||p===void 0?void 0:p.code)!==void 0){const i=n.error;throw new Error(`Error code ${i.code}, see XUMM Dev Console, reference: ${i.reference}`)}}V.throwIfError=St;class kt{constructor(){this.resolveFn=e=>{},this.rejectFn=e=>{},this.promise=new Promise((e,t)=>{this.resolveFn=e,this.rejectFn=t})}resolve(e){return this.resolveFn(e),this.promise}reject(e){return this.rejectFn(e),this.promise}}V.DeferredPromise=kt;var $e;function At(){if($e)return le;$e=1;var n=j&&j.__awaiter||function(k,h,d,w){function g(l){return l instanceof d?l:new d(function(f){f(l)})}return new(d||(d=Promise))(function(l,f){function o(S){try{A(w.next(S))}catch(P){f(P)}}function v(S){try{A(w.throw(S))}catch(P){f(P)}}function A(S){S.done?l(S.value):g(S.value).then(o,v)}A((w=w.apply(k,h||[])).next())})},e=j&&j.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(le,"__esModule",{value:!0}),le.Meta=void 0;const t=oe,r=e(xt),{fetch:c,Request:u,Response:p,Headers:y}=r.default(),m=H,i=V,s=ke(),_=t.debug("xumm-sdk:meta");let O=class{constructor(h,d){this.isBrowser=!1,this.jwtFlow=!1,this.injected=!1,this.endpoint="https://xumm.app",_("Constructed");const w=new RegExp("^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"),g={split:d.split(":"),uuidv4:""};if(g.split.length===3&&g.split.slice(0,2).join(":")==="xApp:OneTimeToken"?(g.uuidv4=g.split[2],this.jwtFlow=!0):g.split.length>1&&g.split[0]==="RAWJWT"?(this.jwtFlow=!0,this.jwt=g.split.slice(1).join(":")):g.uuidv4=d,!w.test(h)||!w.test(g.uuidv4))if(this.jwtFlow){if(!this.jwt)throw new Error("Invalid API Key and/or OTT (One Time Token). Provide OTT param (2nd param) or make sure `xAppToken` query param is present (Browser)")}else throw new Error("Invalid API Key and/or API Secret. Use dotenv or constructor params.");return typeof globalThis<"u"&&Object.keys(globalThis).indexOf("window")<0?_("Running in node"):(console.log("XUMM SDK: Running in browser"),this.isBrowser=!0),this.apiKey=h,this.apiSecret=g.uuidv4,this.jwtFlow&&!this.jwt&&(this.authPromise=new Promise(l=>{this.authPromiseResolve=l}),Promise.resolve().then(()=>this.authorize()).catch(l=>{_("Authorize error:",l.message),!(this===null||this===void 0)&&this.invoker&&this.invoker.caught(l),this.authPromiseResolve&&this.authPromiseResolve()})),this}setEndpoint(h){return h.match(/^http/)?(this.endpoint=h.trim(),!0):!1}authorize(){var h,d,w,g;return n(this,void 0,void 0,function*(){_("JWT Authorize",this.apiSecret);let l;!(this===null||this===void 0)&&this.invoker&&this.invoker.constructor===s.XummSdkJwt&&(l=this.invoker._jwtStore(this,o=>this.jwt=o));const f=(l==null?void 0:l.get(this.apiSecret))||(yield this.call("authorize"));if(!((d=(h=f)===null||h===void 0?void 0:h.error)===null||d===void 0)&&d.code)_("Could not resolve API Key & OTT to JWT (already fetched? Unauthorized?)"),!(this===null||this===void 0)&&this.invoker&&this.invoker.constructor===s.XummSdkJwt&&(!((w=this===null||this===void 0?void 0:this.invoker)===null||w===void 0)&&w.fatalHandler)?this.invoker.fatalHandler(new Error(f.error.reference)):i.throwIfError(f);else if(!((g=f)===null||g===void 0)&&g.jwt){const o=f;l==null||l.set(this.apiSecret,o)}else throw new Error("Unexpected response for xApp JWT authorize request");this.authPromiseResolve&&this.authPromiseResolve()})}call(h,d="GET",w){var g;return n(this,void 0,void 0,function*(){const l=d.toUpperCase(),f=h.split("/")[0];this.jwtFlow&&!(!(this===null||this===void 0)&&this.jwt)&&this.authPromise&&h!=="authorize"&&(yield this.authPromise);try{let o;typeof w<"u"&&(typeof w=="object"&&w!==null&&(o=JSON.stringify(w)),typeof w=="string"&&(o=w));const v={"Content-Type":"application/json"};this.isBrowser||Object.assign(v,{"User-Agent":`xumm-sdk/node (${m.hostname()}) node-fetch`}),this.jwtFlow?h==="authorize"?Object.assign(v,{"x-api-key":this.apiKey,"x-api-ott":this.apiSecret}):Object.assign(v,{Authorization:"Bearer "+this.jwt}):Object.assign(v,{"x-api-key":this.apiKey,"x-api-secret":this.apiSecret});const A=["authorize","ping","curated-assets","rates","payload","userdata","xrpl-tx","nftoken-detail","rails","hookhash"],S=this.jwtFlow&&A.indexOf(f)>-1?"jwt":"platform";return yield(yield c(this.endpoint+"/api/v1/"+S+"/"+h,{method:l,body:o,headers:v})).json()}catch(o){const v=new Error(`Unexpected response from XUMM API [${l}:${f}]`);throw v.stack=((g=o)===null||g===void 0?void 0:g.stack)||void 0,v}})}ping(){var h,d;return n(this,void 0,void 0,function*(){const w=yield this.call("ping");if(i.throwIfError(w),typeof w.auth<"u")return w.auth;if(typeof((h=w)===null||h===void 0?void 0:h.ott_uuidv4)<"u")return{application:{uuidv4:w.app_uuidv4,name:w.app_name},jwtData:w};if(typeof((d=w)===null||d===void 0?void 0:d.usertoken_uuidv4)<"u")return{application:{uuidv4:w.client_id,name:w.app_name},jwtData:w};throw new Error("Unexpected response for ping request")})}getCuratedAssets(){return n(this,void 0,void 0,function*(){return yield this.call("curated-assets")})}getRates(h){return n(this,void 0,void 0,function*(){return yield this.call("rates/"+h.trim().toUpperCase())})}getKycStatus(h){return n(this,void 0,void 0,function*(){if(h.trim().match(/^r/)){const d=yield this.call("kyc-status/"+h.trim());return d!=null&&d.kycApproved?"SUCCESSFUL":"NONE"}else{const d=yield this.call("kyc-status","POST",{user_token:h});return(d==null?void 0:d.kycStatus)||"NONE"}})}getRails(){return n(this,void 0,void 0,function*(){return yield this.call("rails")})}getHookHash(h){return n(this,void 0,void 0,function*(){if(typeof h=="string"&&h.trim().match(/^[A-Fa-f0-9]{64}$/))return yield this.call("hookhash/"+h.trim());throw Error("Invalid Hook Hash (expecting 64 char hex)")})}getHookHashes(){return n(this,void 0,void 0,function*(){return yield this.call("hookhash")})}getTransaction(h){return n(this,void 0,void 0,function*(){return yield this.call("xrpl-tx/"+h.trim())})}getNftokenDetail(h){return n(this,void 0,void 0,function*(){if(!this.jwtFlow)throw new Error("getNftokenDetail: only available in JWT (XummSdkJwt) mode");return yield this.call("nftoken-detail/"+h.trim())})}verifyUserTokens(h){return n(this,void 0,void 0,function*(){return(yield this.call("user-tokens","POST",{tokens:Array.isArray(h)?h:[h]})).tokens})}_inject(h){if(!this.injected)this.invoker=h;else throw new Error("Cannot `_inject` twice")}};return le.Meta=O,le}var Pe={},Oe=j&&j.__awaiter||function(n,e,t,r){function c(u){return u instanceof t?u:new t(function(p){p(u)})}return new(t||(t=Promise))(function(u,p){function y(s){try{i(r.next(s))}catch(_){p(_)}}function m(s){try{i(r.throw(s))}catch(_){p(_)}}function i(s){s.done?u(s.value):c(s.value).then(y,m)}i((r=r.apply(n,e||[])).next())})};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.Storage=void 0;const Pt=oe,Re=V,Et=Pt.debug("xumm-sdk:storage");class Tt{constructor(e){Et("Constructed"),this.Meta=e}get(){return Oe(this,void 0,void 0,function*(){const e=yield this.Meta.call("app-storage","GET");return Re.throwIfError(e),e.data})}set(e){return Oe(this,void 0,void 0,function*(){const t=yield this.Meta.call("app-storage","POST",e);return Re.throwIfError(t),t.stored})}delete(){return Oe(this,void 0,void 0,function*(){const e=yield this.Meta.call("app-storage","DELETE");return Re.throwIfError(e),e.stored})}}Pe.Storage=Tt;var Ee={},Ce,He;function jt(){if(He)return Ce;He=1;var n=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return Ce=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}(),Ce}const Ot="websocket",Rt="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",Ct=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],Jt="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",Xt=["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],Bt="1.0.34",Mt={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},Dt="https://github.com/theturtle32/WebSocket-Node",It={node:">=4.0.0"},Ut={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},Ft={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},Lt={verbose:!1},Wt={test:"tape test/unit/*.js",gulp:"gulp"},$t="index",Ht={lib:"./lib"},zt="lib/browser.js",Nt="Apache-2.0",Kt={name:Ot,description:Rt,keywords:Ct,author:Jt,contributors:Xt,version:Bt,repository:Mt,homepage:Dt,engines:It,dependencies:Ut,devDependencies:Ft,config:Lt,scripts:Wt,main:$t,directories:Ht,browser:zt,license:Nt};var qt=Kt.version,ie;if(typeof globalThis=="object")ie=globalThis;else try{ie=jt()}catch{}finally{if(!ie&&typeof window<"u"&&(ie=window),!ie)throw new Error("Could not determine global this")}var pe=ie.WebSocket||ie.MozWebSocket,Vt=qt;function nt(n,e){var t;return e?t=new pe(n,e):t=new pe(n),t}pe&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(nt,n,{get:function(){return pe[n]}})});var Gt={w3cwebsocket:pe?nt:null,version:Vt},Y=j&&j.__awaiter||function(n,e,t,r){function c(u){return u instanceof t?u:new t(function(p){p(u)})}return new(t||(t=Promise))(function(u,p){function y(s){try{i(r.next(s))}catch(_){p(_)}}function m(s){try{i(r.throw(s))}catch(_){p(_)}}function i(s){s.done?u(s.value):c(s.value).then(y,m)}i((r=r.apply(n,e||[])).next())})};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.Payload=void 0;const st=oe,Qt=Gt,de=V,Yt=st.debug("xumm-sdk:payload"),G=st.debug("xumm-sdk:payload:websocket"),Zt=30,er=2,tr=2,rr=10;class ir{constructor(e){Yt("Constructed"),this.Meta=e}resolvePayload(e){var t,r,c;return Y(this,void 0,void 0,function*(){if(typeof e=="string")return yield this.get(e,!0);if(typeof((t=e)===null||t===void 0?void 0:t.uuid)<"u")return yield this.get(e.uuid,!0);if(typeof((c=(r=e)===null||r===void 0?void 0:r.meta)===null||c===void 0?void 0:c.uuid)<"u")return e;throw new Error("Could not resolve payload (not found)")})}create(e,t=!1){var r;return Y(this,void 0,void 0,function*(){const c=typeof e.TransactionType<"u"&&typeof e.txjson>"u",u=yield this.Meta.call("payload","POST",c?{txjson:e}:e);return t&&de.throwIfError(u),((r=u)===null||r===void 0?void 0:r.next)!==void 0?u:null})}get(e,t=!1){var r,c;return Y(this,void 0,void 0,function*(){const u=typeof e=="string"?e:e==null?void 0:e.uuid,p=yield this.Meta.call("payload/"+u,"GET");return t&&de.throwIfError(p),((c=(r=p)===null||r===void 0?void 0:r.meta)===null||c===void 0?void 0:c.uuid)!==void 0?p:null})}subscribe(e,t){return Y(this,void 0,void 0,function*(){const r=new de.DeferredPromise,c=yield this.resolvePayload(e);if(c){const u="undefined";let p,y,m,i=0;r.promise.then(()=>{clearTimeout(y),clearTimeout(m),p.close()});const s=()=>{var _,O;return p=typeof((_=globalThis)===null||_===void 0?void 0:_.MockedWebSocket)!==u&&typeof jest!==u?new((O=globalThis)===null||O===void 0?void 0:O.MockedWebSocket)("ws://xumm.local"):new Qt.w3cwebsocket(this.Meta.endpoint.replace(/^http/,"ws")+"/sign/"+c.meta.uuid),p.onopen=()=>{console.log(`Payload ${c.meta.uuid}: subscription active (WebSocket opened)`),y=setInterval(()=>{G("Send keepalive"),p.send('{"ping":true}')},tr*1e3)},p.onmessage=k=>Y(this,void 0,void 0,function*(){i=0;const h=k.data;let d;try{if(d=JSON.parse(h.toString()),d!=null&&d.message&&d.message==="Right back at you!"){G("Keepalive response"),clearTimeout(m),m=setTimeout(()=>{console.log(`WebSocket for ${c.meta.uuid} keepalive response timeout, assume dead... (Reconnect)`),p.close(1002,"Assume dead")},rr*1e3);return}if(d!=null&&d.signed||d!=null&&d.expired){const w=yield this.resolvePayload(e);Object.assign(c,Object.assign({},w))}}catch(w){G(`Payload ${c.meta.uuid}: Received message, unable to parse as JSON`,w)}if(d&&t&&typeof d.devapp_fetched>"u")try{const w=yield t({uuid:c.meta.uuid,data:d,resolve(g){return Y(this,void 0,void 0,function*(){yield r.resolve(g||void 0)})},payload:c});w!==void 0&&r.resolve(w)}catch(w){G(`Payload ${c.meta.uuid}: Callback exception`,w),console.log(`Payload ${c.meta.uuid}: Callback exception: ${w.message}`)}}),p.onclose=k=>{G("Closed [code]",k.code),G("Closed [reason]",k.reason),G("Closed [wasClean]",k.wasClean),clearInterval(y),clearTimeout(m),(k.code>1e3||k.wasClean===!1)&&(G("Unhealthy disconnect, reconnecting...",k.code),i<Zt?(i===0&&console.log(`WebSocket for ${c.meta.uuid} lost, reconnecting...`),setTimeout(()=>{i++,G("# Reconnect"),p=s()},er*1e3)):console.log(`WebSocket for ${c.meta.uuid} exceeded reconnect timeouts, give up`)),G(`Payload ${c.meta.uuid}: Subscription ended (WebSocket closed)`)},p};return p=s(),{payload:c,resolve(_){r.resolve(_||void 0)},resolved:r.promise,websocket:p}}throw de.throwIfError(c),Error("Couldn't subscribe: couldn't fetch payload")})}cancel(e,t=!1){var r,c,u;return Y(this,void 0,void 0,function*(){const p=yield this.resolvePayload(e),y=yield this.Meta.call("payload/"+((r=p==null?void 0:p.meta)===null||r===void 0?void 0:r.uuid),"DELETE");return t&&de.throwIfError(y),((u=(c=y)===null||c===void 0?void 0:c.meta)===null||u===void 0?void 0:u.uuid)!==void 0?y:null})}createAndSubscribe(e,t){return Y(this,void 0,void 0,function*(){const r=yield this.create(e,!0);if(r){const c=yield this.subscribe(r,t);return Object.assign({created:r},c)}throw new Error("Error creating payload or subscribing to created payload")})}}Ee.Payload=ir;var Te={},ce={},ge=j&&j.__awaiter||function(n,e,t,r){function c(u){return u instanceof t?u:new t(function(p){p(u)})}return new(t||(t=Promise))(function(u,p){function y(s){try{i(r.next(s))}catch(_){p(_)}}function m(s){try{i(r.throw(s))}catch(_){p(_)}}function i(s){s.done?u(s.value):c(s.value).then(y,m)}i((r=r.apply(n,e||[])).next())})};Object.defineProperty(ce,"__esModule",{value:!0});ce.JwtUserdata=void 0;const or=oe,_e=V,nr=or.debug("xumm-sdk:xapp:userdata");class sr{constructor(e){nr("Constructed"),this.Meta=e}list(){return ge(this,void 0,void 0,function*(){const e=yield this.Meta.call("userdata","GET");return _e.throwIfError(e),e.keys})}get(e){var t;return ge(this,void 0,void 0,function*(){const r=Array.isArray(e)?e.join(","):e,c=yield this.Meta.call("userdata/"+r,"GET");return _e.throwIfError(c),r.split(",").length>1?c.data:((t=c.data)===null||t===void 0?void 0:t[r])||{}})}delete(e){return ge(this,void 0,void 0,function*(){const t=yield this.Meta.call("userdata/"+e,"DELETE");return _e.throwIfError(t),t.persisted})}set(e,t){return ge(this,void 0,void 0,function*(){const r=yield this.Meta.call("userdata/"+e,"POST",t);return _e.throwIfError(r),r.persisted})}}ce.JwtUserdata=sr;var ar=j&&j.__awaiter||function(n,e,t,r){function c(u){return u instanceof t?u:new t(function(p){p(u)})}return new(t||(t=Promise))(function(u,p){function y(s){try{i(r.next(s))}catch(_){p(_)}}function m(s){try{i(r.throw(s))}catch(_){p(_)}}function i(s){s.done?u(s.value):c(s.value).then(y,m)}i((r=r.apply(n,e||[])).next())})};Object.defineProperty(Te,"__esModule",{value:!0});Te.xApp=void 0;const ur=oe,cr=ce,lr=V,dr=ur.debug("xumm-sdk:xapp");class fr{constructor(e){dr("Constructed"),this.Meta=e,this.userdata=new cr.JwtUserdata(e)}get(e){return ar(this,void 0,void 0,function*(){const t=yield this.Meta.call("xapp/ott/"+e,"GET");return lr.throwIfError(t),t})}}Te.xApp=fr;var je={},ze=j&&j.__awaiter||function(n,e,t,r){function c(u){return u instanceof t?u:new t(function(p){p(u)})}return new(t||(t=Promise))(function(u,p){function y(s){try{i(r.next(s))}catch(_){p(_)}}function m(s){try{i(r.throw(s))}catch(_){p(_)}}function i(s){s.done?u(s.value):c(s.value).then(y,m)}i((r=r.apply(n,e||[])).next())})};Object.defineProperty(je,"__esModule",{value:!0});je.Push=void 0;const hr=oe,vr=ce,Ne=V,pr=hr.debug("xumm-sdk:xapp");class mr{constructor(e){pr("Constructed"),this.Meta=e,this.userdata=new vr.JwtUserdata(e)}event(e){return ze(this,void 0,void 0,function*(){const t=yield this.Meta.call("xapp/event","POST",e);return Ne.throwIfError(t),t})}notification(e){return ze(this,void 0,void 0,function*(){const t=yield this.Meta.call("xapp/push","POST",e);return Ne.throwIfError(t),t})}}je.Push=mr;var Ke;function ke(){if(Ke)return ee;Ke=1;var n={},e=j&&j.__awaiter||function(k,h,d,w){function g(l){return l instanceof d?l:new d(function(f){f(l)})}return new(d||(d=Promise))(function(l,f){function o(S){try{A(w.next(S))}catch(P){f(P)}}function v(S){try{A(w.throw(S))}catch(P){f(P)}}function A(S){S.done?l(S.value):g(S.value).then(o,v)}A((w=w.apply(k,h||[])).next())})};Object.defineProperty(ee,"__esModule",{value:!0}),ee.XummSdkJwt=ee.XummSdk=void 0;const t=oe,r=At(),c=Pe,u=Ee,p=Te,y=je,m=ce,i=it,s=t.debug("xumm-sdk");class _{constructor(h,d){return s("Constructed"),this.Meta=new r.Meta(h||this.getEnv("XUMM_APIKEY"),d||this.getEnv("XUMM_APISECRET")),this.storage=new c.Storage(this.Meta),this.payload=new u.Payload(this.Meta),this.jwtUserdata=new m.JwtUserdata(this.Meta),this.Push=new y.Push(this.Meta),this.xApp=new p.xApp(this.Meta),this.Meta._inject(this),this}getEnv(h){let d="";try{d=typeof Deno<"u"&&Deno.env.get(h)||"",d=(process==null?void 0:n[h])||""}catch{}return d}ping(){return this.Meta.ping()}getCuratedAssets(){return this.Meta.getCuratedAssets()}getRails(){return this.Meta.getRails()}getHookHashes(){return this.Meta.getHookHashes()}getHookHash(h){return this.Meta.getHookHash(h)}getRates(h){return this.Meta.getRates(h)}getKycStatus(h){return this.Meta.getKycStatus(h)}getTransaction(h){return this.Meta.getTransaction(h)}getNftokenDetail(h){return this.Meta.getNftokenDetail(h)}verifyUserTokens(h){return this.Meta.verifyUserTokens(h)}verifyUserToken(h){return e(this,void 0,void 0,function*(){const d=yield this.Meta.verifyUserTokens([h]);return Array.isArray(d)&&d.length===1?d[0]:null})}setEndpoint(h){return this.Meta.setEndpoint(h)}caught(h){throw h}}ee.XummSdk=_;class O extends _{constructor(h,d,w){var g,l,f,o,v,A,S,P,J;let z=String(d||"").trim().toLowerCase();const M=h.length!==36;if(!M&&typeof d>"u"&&typeof window<"u"&&typeof window.URLSearchParams<"u"){const I=new window.URLSearchParams(((g=window==null?void 0:window.location)===null||g===void 0?void 0:g.search)||"");for(const C of I.entries())C[0]==="xAppToken"&&(z=C[1].toLowerCase().trim());if(z===""&&!(w!=null&&w.store)&&!(w!=null&&w.noAutoRetrieve)&&typeof((l=window==null?void 0:window.localStorage)===null||l===void 0?void 0:l.XummSdkJwt)=="string")try{const C=(o=(f=window==null?void 0:window.localStorage)===null||f===void 0?void 0:f.XummSdkJwt)===null||o===void 0?void 0:o.split(":"),D=JSON.parse((v=C==null?void 0:C.slice(1))===null||v===void 0?void 0:v.join(":"));if(D!=null&&D.jwt){const Z=typeof Deno<"u"?new TextDecoder().decode(decode((A=D.jwt.split("."))===null||A===void 0?void 0:A[1])):i.Buffer.from((S=D.jwt.split("."))===null||S===void 0?void 0:S[1],"base64").toString("utf8")+"",N=JSON.parse(Z);if(N!=null&&N.exp){const a=(N==null?void 0:N.exp)-Math.floor(new Date().getTime()/1e3);console.log("Restoring OTT "+(C==null?void 0:C[0])),a>60*60?z=C==null?void 0:C[0]:console.log("Skip restore: not valid for one more hour")}}}catch(C){console.log("JWT Restore Error",C)}}super(h,!M&&z!==""?"xApp:OneTimeToken:"+z:"RAWJWT:"+h),this.resolve=I=>{s("OTT data resolved",I)},this.reject=I=>{s("OTT data rejected",I.message)},this.ottResolved=M?Promise.resolve():new Promise((I,C)=>{this.resolve=I,this.reject=C}),w!=null&&w.fatalHandler&&(this.fatalHandler=w.fatalHandler),this.store={get(I){var C;if(s("[JwtStore] » Builtin JWT store GET"),typeof window<"u"&&typeof window.localStorage<"u"&&typeof window.localStorage.XummSdkJwt=="string"){const D=window.localStorage.XummSdkJwt.split(":");if(D[0]===I){s("Restoring OTT from localStorage:",I);try{return JSON.parse(D.slice(1).join(":"))}catch(Z){s("Error restoring OTT Data (JWT) from localStorage",(C=Z)===null||C===void 0?void 0:C.message)}}}},set(I,C){s("[JwtStore] » Builtin JWT store SET",I),typeof window<"u"&&typeof localStorage<"u"&&(window.localStorage.XummSdkJwt=I+":"+JSON.stringify(C))}},!((P=w==null?void 0:w.store)===null||P===void 0)&&P.get&&(this.store.get=w.store.get),!((J=w==null?void 0:w.store)===null||J===void 0)&&J.set&&(this.store.set=w.store.set),M?(this.reject(new Error("Not in OTT flow: in raw JWT (OAuth2-like) flow")),s("Using JWT (Raw, OAuth2) flow")):s("Using JWT (xApp) flow")}_jwtStore(h,d){if(h&&(h==null?void 0:h.constructor)===r.Meta)return{get:w=>{var g;return s("[JwtStore] Proxy GET"),(g=this.store)===null||g===void 0?void 0:g.get(w)},set:(w,g)=>{var l;return s("[JwtStore] Proxy SET"),this.resolve(g.ott),d(g.jwt),this.jwt=g.jwt,(l=this.store)===null||l===void 0?void 0:l.set(w,g)}};throw new Error("Invalid _jwtStore invoker")}getOttData(){return e(this,void 0,void 0,function*(){const h=yield this.ottResolved;if(h)return h;throw new Error("Called getOttData on a non OTT-JWT flow")})}getJwt(){return e(this,void 0,void 0,function*(){return yield this.ottResolved,this.jwt})}caught(h){this.reject(h)}}return ee.XummSdkJwt=O,ee}var Fe={},at={exports:{}},Je={exports:{}},qe;function Le(){return qe||(qe=1,function(n,e){(function(t,r){n.exports=r()})(j,function(){var t=t||function(r,c){var u;if(typeof window<"u"&&window.crypto&&(u=window.crypto),typeof self<"u"&&self.crypto&&(u=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(u=globalThis.crypto),!u&&typeof window<"u"&&window.msCrypto&&(u=window.msCrypto),!u&&typeof j<"u"&&j.crypto&&(u=j.crypto),!u&&typeof yt=="function")try{u=gt}catch{}var p=function(){if(u){if(typeof u.getRandomValues=="function")try{return u.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof u.randomBytes=="function")try{return u.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},y=Object.create||function(){function l(){}return function(f){var o;return l.prototype=f,o=new l,l.prototype=null,o}}(),m={},i=m.lib={},s=i.Base=function(){return{extend:function(l){var f=y(this);return l&&f.mixIn(l),(!f.hasOwnProperty("init")||this.init===f.init)&&(f.init=function(){f.$super.init.apply(this,arguments)}),f.init.prototype=f,f.$super=this,f},create:function(){var l=this.extend();return l.init.apply(l,arguments),l},init:function(){},mixIn:function(l){for(var f in l)l.hasOwnProperty(f)&&(this[f]=l[f]);l.hasOwnProperty("toString")&&(this.toString=l.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),_=i.WordArray=s.extend({init:function(l,f){l=this.words=l||[],f!=c?this.sigBytes=f:this.sigBytes=l.length*4},toString:function(l){return(l||k).stringify(this)},concat:function(l){var f=this.words,o=l.words,v=this.sigBytes,A=l.sigBytes;if(this.clamp(),v%4)for(var S=0;S<A;S++){var P=o[S>>>2]>>>24-S%4*8&255;f[v+S>>>2]|=P<<24-(v+S)%4*8}else for(var J=0;J<A;J+=4)f[v+J>>>2]=o[J>>>2];return this.sigBytes+=A,this},clamp:function(){var l=this.words,f=this.sigBytes;l[f>>>2]&=4294967295<<32-f%4*8,l.length=r.ceil(f/4)},clone:function(){var l=s.clone.call(this);return l.words=this.words.slice(0),l},random:function(l){for(var f=[],o=0;o<l;o+=4)f.push(p());return new _.init(f,l)}}),O=m.enc={},k=O.Hex={stringify:function(l){for(var f=l.words,o=l.sigBytes,v=[],A=0;A<o;A++){var S=f[A>>>2]>>>24-A%4*8&255;v.push((S>>>4).toString(16)),v.push((S&15).toString(16))}return v.join("")},parse:function(l){for(var f=l.length,o=[],v=0;v<f;v+=2)o[v>>>3]|=parseInt(l.substr(v,2),16)<<24-v%8*4;return new _.init(o,f/2)}},h=O.Latin1={stringify:function(l){for(var f=l.words,o=l.sigBytes,v=[],A=0;A<o;A++){var S=f[A>>>2]>>>24-A%4*8&255;v.push(String.fromCharCode(S))}return v.join("")},parse:function(l){for(var f=l.length,o=[],v=0;v<f;v++)o[v>>>2]|=(l.charCodeAt(v)&255)<<24-v%4*8;return new _.init(o,f)}},d=O.Utf8={stringify:function(l){try{return decodeURIComponent(escape(h.stringify(l)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(l){return h.parse(unescape(encodeURIComponent(l)))}},w=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new _.init,this._nDataBytes=0},_append:function(l){typeof l=="string"&&(l=d.parse(l)),this._data.concat(l),this._nDataBytes+=l.sigBytes},_process:function(l){var f,o=this._data,v=o.words,A=o.sigBytes,S=this.blockSize,P=S*4,J=A/P;l?J=r.ceil(J):J=r.max((J|0)-this._minBufferSize,0);var z=J*S,M=r.min(z*4,A);if(z){for(var I=0;I<z;I+=S)this._doProcessBlock(v,I);f=v.splice(0,z),o.sigBytes-=M}return new _.init(f,M)},clone:function(){var l=s.clone.call(this);return l._data=this._data.clone(),l},_minBufferSize:0});i.Hasher=w.extend({cfg:s.extend(),init:function(l){this.cfg=this.cfg.extend(l),this.reset()},reset:function(){w.reset.call(this),this._doReset()},update:function(l){return this._append(l),this._process(),this},finalize:function(l){l&&this._append(l);var f=this._doFinalize();return f},blockSize:16,_createHelper:function(l){return function(f,o){return new l.init(o).finalize(f)}},_createHmacHelper:function(l){return function(f,o){return new g.HMAC.init(l,o).finalize(f)}}});var g=m.algo={};return m}(Math);return t})}(Je)),Je.exports}(function(n,e){(function(t,r){n.exports=r(Le())})(j,function(t){return function(r){var c=t,u=c.lib,p=u.WordArray,y=u.Hasher,m=c.algo,i=[],s=[];(function(){function k(g){for(var l=r.sqrt(g),f=2;f<=l;f++)if(!(g%f))return!1;return!0}function h(g){return(g-(g|0))*4294967296|0}for(var d=2,w=0;w<64;)k(d)&&(w<8&&(i[w]=h(r.pow(d,1/2))),s[w]=h(r.pow(d,1/3)),w++),d++})();var _=[],O=m.SHA256=y.extend({_doReset:function(){this._hash=new p.init(i.slice(0))},_doProcessBlock:function(k,h){for(var d=this._hash.words,w=d[0],g=d[1],l=d[2],f=d[3],o=d[4],v=d[5],A=d[6],S=d[7],P=0;P<64;P++){if(P<16)_[P]=k[h+P]|0;else{var J=_[P-15],z=(J<<25|J>>>7)^(J<<14|J>>>18)^J>>>3,M=_[P-2],I=(M<<15|M>>>17)^(M<<13|M>>>19)^M>>>10;_[P]=z+_[P-7]+I+_[P-16]}var C=o&v^~o&A,D=w&g^w&l^g&l,Z=(w<<30|w>>>2)^(w<<19|w>>>13)^(w<<10|w>>>22),N=(o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25),a=S+N+C+s[P]+_[P],b=Z+D;S=A,A=v,v=o,o=f+a|0,f=l,l=g,g=w,w=a+b|0}d[0]=d[0]+w|0,d[1]=d[1]+g|0,d[2]=d[2]+l|0,d[3]=d[3]+f|0,d[4]=d[4]+o|0,d[5]=d[5]+v|0,d[6]=d[6]+A|0,d[7]=d[7]+S|0},_doFinalize:function(){var k=this._data,h=k.words,d=this._nDataBytes*8,w=k.sigBytes*8;return h[w>>>5]|=128<<24-w%32,h[(w+64>>>9<<4)+14]=r.floor(d/4294967296),h[(w+64>>>9<<4)+15]=d,k.sigBytes=h.length*4,this._process(),this._hash},clone:function(){var k=y.clone.call(this);return k._hash=this._hash.clone(),k}});c.SHA256=y._createHelper(O),c.HmacSHA256=y._createHmacHelper(O)}(Math),t.SHA256})})(at);var wr=at.exports,ut={exports:{}};(function(n,e){(function(t,r){n.exports=r(Le())})(j,function(t){return function(){var r=t,c=r.lib,u=c.WordArray,p=r.enc;p.Base64={stringify:function(m){var i=m.words,s=m.sigBytes,_=this._map;m.clamp();for(var O=[],k=0;k<s;k+=3)for(var h=i[k>>>2]>>>24-k%4*8&255,d=i[k+1>>>2]>>>24-(k+1)%4*8&255,w=i[k+2>>>2]>>>24-(k+2)%4*8&255,g=h<<16|d<<8|w,l=0;l<4&&k+l*.75<s;l++)O.push(_.charAt(g>>>6*(3-l)&63));var f=_.charAt(64);if(f)for(;O.length%4;)O.push(f);return O.join("")},parse:function(m){var i=m.length,s=this._map,_=this._reverseMap;if(!_){_=this._reverseMap=[];for(var O=0;O<s.length;O++)_[s.charCodeAt(O)]=O}var k=s.charAt(64);if(k){var h=m.indexOf(k);h!==-1&&(i=h)}return y(m,i,_)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function y(m,i,s){for(var _=[],O=0,k=0;k<i;k++)if(k%4){var h=s[m.charCodeAt(k-1)]<<k%4*2,d=s[m.charCodeAt(k)]>>>6-k%4*2,w=h|d;_[O>>>2]|=w<<24-O%4*8,O++}return u.create(_,O)}}(),t.enc.Base64})})(ut);var yr=ut.exports,ct={exports:{}};(function(n,e){(function(t,r){n.exports=r(Le())})(j,function(t){return function(){if(typeof ArrayBuffer=="function"){var r=t,c=r.lib,u=c.WordArray,p=u.init,y=u.init=function(m){if(m instanceof ArrayBuffer&&(m=new Uint8Array(m)),(m instanceof Int8Array||typeof Uint8ClampedArray<"u"&&m instanceof Uint8ClampedArray||m instanceof Int16Array||m instanceof Uint16Array||m instanceof Int32Array||m instanceof Uint32Array||m instanceof Float32Array||m instanceof Float64Array)&&(m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength)),m instanceof Uint8Array){for(var i=m.byteLength,s=[],_=0;_<i;_++)s[_>>>2]|=m[_]<<24-_%4*8;p.call(this,s,i)}else p.apply(this,arguments)};y.prototype=u}}(),t.lib.WordArray})})(ct);var gr=ct.exports,Ae=j&&j.__assign||function(){return Ae=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(n[c]=e[c])}return n},Ae.apply(this,arguments)},We=j&&j.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Fe,"__esModule",{value:!0});var _r=We(wr),br=We(yr),xr=We(gr),Sr=function(){function n(e){this.state="",this.codeVerifier="",this.config=e}return n.prototype.authorizeUrl=function(e){var t,r;e===void 0&&(e={});var c=new URLSearchParams(Object.assign(Ae({response_type:!((t=this.config)===null||t===void 0)&&t.implicit?"token":"code",client_id:this.config.client_id,state:this.getState(e.state||null),scope:this.config.requested_scopes,redirect_uri:this.config.redirect_uri},!((r=this.config)===null||r===void 0)&&r.implicit?{}:{code_challenge:this.pkceChallengeFromVerifier(),code_challenge_method:"S256"}),e)).toString();return"".concat(this.config.authorization_endpoint,"?").concat(c)},n.prototype.exchangeForAccessToken=function(e,t){var r=this;return t===void 0&&(t={}),this.parseAuthResponseUrl(e).then(function(c){var u,p;if(!((u=r.config)===null||u===void 0)&&u.implicit){var y={access_token:"",expires_in:0,refresh_expires_in:0,refresh_token:"",scope:"",token_type:""},m=new URL(e).searchParams;return m.forEach(function(i,s){Object.keys(y).indexOf(s)>-1&&(y[s]=typeof y[s]=="number"?Number(i):String(i))}),Promise.resolve(Object.assign(y,t))}return fetch(r.config.token_endpoint,{method:"POST",body:new URLSearchParams(Object.assign(Ae({grant_type:"authorization_code",code:c.code,client_id:r.config.client_id,redirect_uri:r.config.redirect_uri},!((p=r.config)===null||p===void 0)&&p.implicit?{}:{code_verifier:r.getCodeVerifier()}),t)),headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(i){return i.json()})})},n.prototype.getCodeVerifier=function(){return this.codeVerifier===""&&(this.codeVerifier=this.randomStringFromStorage("pkce_code_verifier")),this.codeVerifier},n.prototype.getState=function(e){e===void 0&&(e=null);var t="pkce_state";return e!==null&&this.getStore().setItem(t,e),this.state===""&&(this.state=this.randomStringFromStorage(t)),this.state},n.prototype.parseAuthResponseUrl=function(e){var t=new URL(e).searchParams;return this.validateAuthResponse({error:t.get("error"),query:t.get("query"),state:t.get("state"),code:t.get("code")})},n.prototype.pkceChallengeFromVerifier=function(){var e=(0,_r.default)(this.getCodeVerifier());return br.default.stringify(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},n.prototype.randomStringFromStorage=function(e){var t=this.getStore().getItem(e);return t===null&&this.getStore().setItem(e,xr.default.random(64)),this.getStore().getItem(e)||""},n.prototype.validateAuthResponse=function(e){var t=this;return new Promise(function(r,c){var u;return e.error?c({error:e.error}):e.state!==t.getState()&&!(!((u=t.config)===null||u===void 0)&&u.implicit)?c({error:"Invalid State"}):r(e)})},n.prototype.getStore=function(){var e;return((e=this.config)===null||e===void 0?void 0:e.storage)||sessionStorage},n}();Fe.default=Sr;var be=j&&j.__awaiter||function(n,e,t,r){function c(u){return u instanceof t?u:new t(function(p){p(u)})}return new(t||(t=Promise))(function(u,p){function y(s){try{i(r.next(s))}catch(_){p(_)}}function m(s){try{i(r.throw(s))}catch(_){p(_)}}function i(s){s.done?u(s.value):c(s.value).then(y,m)}i((r=r.apply(n,e||[])).next())})},kr=j&&j.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ue,"__esModule",{value:!0});ue.XummPkce=ue.XummPkceThread=void 0;const Ar=Ie,Ve=ke(),Pr=kr(Fe),W=function(...n){typeof localStorage<"u"&&localStorage!=null&&localStorage.debug&&console.log(...n)};typeof window<"u"&&W("Xumm OAuth2 PKCE Authorization Code Flow lib.");const fe=n=>{let e=r=>{};return{promise:new Promise(r=>{e=r}),resolve:r=>e(r)}};class lt extends Ar.EventEmitter{constructor(e,t){var r,c;super(),this.popup=null,this.resolved=!1,this.mobileRedirectFlow=!1,this.eventPromises={retrieved:fe(),error:fe(),success:fe(),loggedout:fe()},this.options={redirectUrl:document.location.href,rememberJwt:!0,storage:localStorage,implicit:!1},typeof t=="string"?this.options.redirectUrl=t:typeof t=="object"&&t&&(typeof t.redirectUrl=="string"&&(this.options.redirectUrl=t.redirectUrl),typeof t.rememberJwt=="boolean"&&(this.options.rememberJwt=t.rememberJwt),typeof t.storage=="object"&&(this.options.storage=t.storage),typeof t.implicit=="boolean"&&(this.options.implicit=t.implicit));const u={client_id:e,redirect_uri:this.options.redirectUrl,authorization_endpoint:"https://oauth2.xumm.app/auth",token_endpoint:"https://oauth2.xumm.app/token",requested_scopes:"XummPkce",storage:this.options.storage,implicit:this.options.implicit};if(this.pkce=new Pr.default(u),this.options.rememberJwt){W("Remember JWT");try{const y=JSON.parse(((r=this.options.storage)===null||r===void 0?void 0:r.getItem("XummPkceJwt"))||"{}");if(y!=null&&y.jwt&&typeof y.jwt=="string"){const m=new Ve.XummSdkJwt(y.jwt);this.ping=m.ping(),this.ping.then(i=>be(this,void 0,void 0,function*(){var s;!((s=i==null?void 0:i.jwtData)===null||s===void 0)&&s.sub?(this.autoResolvedFlow=Object.assign(y,{sdk:m}),yield this.authorize(),this.emit("retrieved")):this.logout()})).catch(i=>{this.logout()})}else this.logout()}catch{}}window.addEventListener("message",y=>{var m;if(W("Received Event from ",y.origin),String((y==null?void 0:y.data)||"").slice(0,1)==="{"&&String((y==null?void 0:y.data)||"").slice(-1)==="}"&&(W("Got PostMessage with JSON"),y.origin==="https://xumm.app"||y.origin==="https://oauth2.xumm.app")){W("Got PostMessage from https://xumm.app / https://oauth2.xumm.app");try{const i=JSON.parse(y.data);(i==null?void 0:i.source)==="xumm_sign_request"&&(i!=null&&i.payload)?W("Payload opened:",i.payload):(i==null?void 0:i.source)==="xumm_sign_request_resolved"&&(i!=null&&i.options)?(W("Payload resolved, mostmessage containing options containing redirect URL: ",i),this.resolved=!0,this.pkce.exchangeForAccessToken(i.options.full_redirect_uri).then(s=>{if(this.jwt=s.access_token,s!=null&&s.error_description)throw new Error(s==null?void 0:s.error_description);fetch("https://oauth2.xumm.app/userinfo",{headers:{Authorization:"Bearer "+s.access_token}}).then(_=>_.json()).then(_=>{var O;if(this.resolvePromise){if(this.options.rememberJwt){W("Remembering JWT");try{(O=this.options.storage)===null||O===void 0||O.setItem("XummPkceJwt",JSON.stringify({jwt:s.access_token,me:_}))}catch(k){W("Could not persist JWT to local storage",k)}}this.resolvePromise({jwt:s.access_token,sdk:new Ve.XummSdkJwt(s.access_token),me:_})}})}).catch(s=>{this.rejectPromise&&this.rejectPromise(s!=null&&s.error?new Error(s.error):s),W((s==null?void 0:s.error)||s)})):(i==null?void 0:i.source)==="xumm_sign_request_rejected"?(W("Payload rejected",i==null?void 0:i.options),this.rejectPromise&&this.rejectPromise(new Error(((m=i==null?void 0:i.options)===null||m===void 0?void 0:m.error_description)||"Payload rejected"))):(i==null?void 0:i.source)==="xumm_sign_request_popup_closed"?(W("Popup closed, wait 750ms"),setTimeout(()=>{!this.resolved&&this.rejectPromise&&this.rejectPromise(new Error("Sign In window closed"))},750)):W("Unexpected message, skipping",i==null?void 0:i.source)}catch(i){W("Error parsing message",(i==null?void 0:i.message)||i)}}},!1);const p=new URLSearchParams(((c=document==null?void 0:document.location)===null||c===void 0?void 0:c.search)||"");if(p.get("authorization_code")||p.get("access_token")||p.get("error_description")){this.mobileRedirectFlow=!0,this.urlParams=p;let y=!1;const m=i=>be(this,void 0,void 0,function*(){W("onDocumentReady",document.readyState),!y&&document.readyState==="complete"&&(y=!0,W("(readystatechange: [ "+document.readyState+" ])"),this.handleMobileGrant(),yield this.authorize(),this.emit("retrieved"))});m(),document.addEventListener("readystatechange",m)}}emit(e,...t){return this.eventPromises[e].promise.then(()=>super.emit(e,...t)),!0}on(e,t){return this.eventPromises[e].resolve(),super.on(e,t)}off(e,t){return this.eventPromises[e]=fe(),super.off(e,t)}authorizeUrl(){return this.pkce.authorizeUrl()}handleMobileGrant(){if(this.urlParams&&this.mobileRedirectFlow){const e={data:JSON.stringify(this.urlParams.get("authorization_code")||this.urlParams.get("access_token")?{source:"xumm_sign_request_resolved",options:{full_redirect_uri:document.location.href}}:{source:"xumm_sign_request_rejected",options:{error:this.urlParams.get("error"),error_code:this.urlParams.get("error_code"),error_description:this.urlParams.get("error_description")}}),origin:"https://oauth2.xumm.app"},t=new MessageEvent("message",e);return window.dispatchEvent(t),!0}return!1}authorize(){return be(this,void 0,void 0,function*(){if(this.resolvedSuccessfully)return this.promise;this.resolved=!1;try{yield this.ping}catch{}if(!this.mobileRedirectFlow&&!this.autoResolvedFlow){const t=this.authorizeUrl(),r=window.open(t,"XummPkceLogin","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=600,height=790");this.popup=r,W("Popup opened...",t)}return this.resolved=!1,(()=>{var t;const r=new URLSearchParams(((t=document==null?void 0:document.location)===null||t===void 0?void 0:t.search)||"");r.delete("authorization_code"),r.delete("code"),r.delete("scope"),r.delete("state"),r.delete("access_token"),r.delete("refresh_token"),r.delete("token_type"),r.delete("expires_in");const c=r.toString(),u=document.location.href.split("?")[0]+(c!==""?"?":"")+c;window.history.replaceState({path:u},"",u)})(),this.autoResolvedFlow?this.resolved||(this.resolved=!0,this.promise=Promise.resolve(this.autoResolvedFlow),this.rejectPromise=this.resolvePromise=()=>{},W("Auto resolved"),this.emit("success")):this.promise=new Promise((t,r)=>{this.resolvePromise=c=>{const u=t(c);return this.resolved=!0,this.resolvedSuccessfully=!0,W("Xumm Sign in RESOLVED"),this.emit("success"),u},this.rejectPromise=c=>{const u=r(c);return this.resolved=!0,this.emit("error",typeof c=="string"?new Error(c):c),W("Xumm Sign in REJECTED"),u}}),this.promise})}state(){return be(this,void 0,void 0,function*(){return this.promise})}logout(){var e;setTimeout(()=>this.emit("loggedout"),0);try{this.resolved=!1,this.resolvedSuccessfully=void 0,this.autoResolvedFlow=void 0,(e=this.options.storage)===null||e===void 0||e.removeItem("XummPkceJwt"),this.mobileRedirectFlow=!1}catch{}}getPopup(){return this===null||this===void 0?void 0:this.popup}}ue.XummPkceThread=lt;const te=n=>{let e=!1;n&&typeof window=="object"&&typeof window._XummPkce>"u"&&(window._XummPkce=n,e=!0);const t=window==null?void 0:window._XummPkce;return t&&e&&W("XummPkce attached to window"),t};class Er{constructor(e,t){typeof window>"u"||typeof document>"u"||te()||te(new lt(e,t))}on(e,t){const r=te();if(r)return r.on(e,t),this}off(e,t){const r=te();if(r)return r.off(e,t),this}authorize(){const e=te();if(e)return e.authorize()}state(){const e=te();if(e)return e.state()}logout(){const e=te();if(e)return e.logout()}}ue.XummPkce=Er;var Xe={},Be={},Ge;function Qe(){return Ge||(Ge=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.xAppEvents=void 0,function(e){e.ready="ready",e.scanQr="scanQr",e.payloadResolved="payloadResolved",e.selectDestination="selectDestination",e.networkSwitch="networkSwitch"}(n.xAppEvents||(n.xAppEvents={}))}(Be)),Be}var Ye;function Tr(){return Ye||(Ye=1,function(n){var e=j&&j.__createBinding||(Object.create?function(f,o,v,A){A===void 0&&(A=v);var S=Object.getOwnPropertyDescriptor(o,v);(!S||("get"in S?!o.__esModule:S.writable||S.configurable))&&(S={enumerable:!0,get:function(){return o[v]}}),Object.defineProperty(f,A,S)}:function(f,o,v,A){A===void 0&&(A=v),f[A]=o[v]}),t=j&&j.__exportStar||function(f,o){for(var v in f)v!=="default"&&!Object.prototype.hasOwnProperty.call(o,v)&&e(o,f,v)},r=j&&j.__awaiter||function(f,o,v,A){function S(P){return P instanceof v?P:new v(function(J){J(P)})}return new(v||(v=Promise))(function(P,J){function z(C){try{I(A.next(C))}catch(D){J(D)}}function M(C){try{I(A.throw(C))}catch(D){J(D)}}function I(C){C.done?P(C.value):S(C.value).then(z,M)}I((A=A.apply(f,o||[])).next())})},c;Object.defineProperty(n,"__esModule",{value:!0}),n.xApp=void 0;const u=Ie,p=Qe();t(Qe(),n);const y=.25,m=250,i=2e3,s=Number(new Date);let _;const O=new Promise(f=>{_=o=>{console.log("Doc Ready...");const v=(Number(new Date)-s)/1e3;v<y?(console.log("Doc not alive >= "+y+" sec, stalling for "+(y-v)),setTimeout(function(){f(o)},(y-v)*1e3)):(console.log("Doc alive "+y+"+ sec, go ahead"),f(o))}});O.then(()=>{console.log("documentReadyPromise resolved")}).catch(f=>{console.log(f)}),typeof document<"u"&&document.addEventListener("readystatechange",f=>{console.log("(readystatechange: [ "+document.readyState+" ])"),document.readyState==="complete"&&_()}),typeof window<"u"&&console.log("Loading xApp SDK");let k=typeof window<"u"?window:{},h=!1;k!=null&&k.parent&&((c=k.parent)===null||c===void 0||c.postMessage("XAPP_PROXY_INIT","*"));const d=(f,o,v=0)=>r(void 0,void 0,void 0,function*(){var A,S;if(yield O,typeof(k==null?void 0:k.ReactNativeWebView)<"u"||h){const P=(Number(new Date)-s)/1e3;["close"].indexOf(f)>-1&&P<4&&(console.log("xApp close, doc alive < minAliveTimeSec, stall: "+(4-P)),yield new Promise(M=>{setTimeout(()=>{M(!0)},(4-P)*1e3)}));const J=JSON.stringify(Object.assign({command:f},o||{}));return h?(A=k.parent)===null||A===void 0||A.postMessage(J,"*"):(S=k.ReactNativeWebView)===null||S===void 0||S.postMessage(J),console.log("xAppActionAttempt Success",f,o),!0}else return v*m<i?(console.log("xAppActionAttempt Attempt "+v+" » Retry",f,o),yield new Promise(P=>{setTimeout(P,m)}),d(f,o,v+1)):(console.log("xAppActionAttempt Failed after attempt "+v,f,o),new Error("xApp."+f.replace(/^xApp/,"")+": could not contact Xumm App Host"))});class w extends u.EventEmitter{constructor(){super(),document.readyState==="complete"&&_();const o=v=>{const A=v;if(typeof(A==null?void 0:A.data)=="string"&&A.data==="XAPP_PROXY_INIT_ACK"){console.log("xApp Proxy ACK received, switching to PROXY (SANDBOX) mode"),h=!0;return}try{const S=JSON.parse((A==null?void 0:A.data)||"{}");if(console.log("_event (typeof, {_event}) ",typeof S,{_event:S}),typeof S=="object"&&S!==null)if(typeof S.method=="string"&&S.method in p.xAppEvents){console.log("xApp Event received",S.method,S);const P=S.method;switch(delete S.method,P){case String(p.xAppEvents.payloadResolved):this.emit("payload",S);break;case String(p.xAppEvents.scanQr):this.emit("qr",S);break;case String(p.xAppEvents.networkSwitch):this.emit("networkswitch",S);break;case String(p.xAppEvents.selectDestination):this.emit("destination",S);break}}else console.log("xApp Event received, not in xAppEvents:",S.method)}catch(S){const P=(S==null?void 0:S.message)||"";P.match(/XAPP_PROXY_INIT/)||console.log("xApp Event received, cannot parse as JSON",P)}};typeof window.addEventListener=="function"&&window.addEventListener("message",o),typeof document.addEventListener=="function"&&document.addEventListener("message",o)}getEnvironment(){const o=g();return o?o.getEnvironment():{version:"",ott:""}}navigate(o){return typeof(o==null?void 0:o.xApp)!="string"?Promise.reject(new Error("xApp.navigate: Invalid argument: `xApp`")):d("xAppNavigate",o)}openSignRequest(o){return typeof(o==null?void 0:o.uuid)!="string"?Promise.reject(new Error("xApp.openSignRequest: Invalid argument: `uuid`")):o.uuid.match(/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i)?d("openSignRequest",o):Promise.reject(new Error("xApp.openSignRequest: Invalid payload UUID"))}selectDestination(o){return d("selectDestination",o)}openBrowser(o){return typeof(o==null?void 0:o.url)!="string"?Promise.reject(new Error("xApp.openBrowser: Invalid argument: `url`")):d("openBrowser",o)}share(o){return typeof(o==null?void 0:o.text)!="string"?Promise.reject(new Error("xApp.share: Invalid argument: `text`")):d("share",o)}scanQr(){return d("scanQr")}tx(o){return typeof(o==null?void 0:o.tx)!="string"?Promise.reject(new Error("xApp.tx: Invalid argument: `tx`")):typeof(o==null?void 0:o.account)!="string"?Promise.reject(new Error("xApp.tx: Invalid argument: `account`")):d("txDetails",o)}close(o){return d("close",o)}ready(){return d("ready")}customCommand(o,v){return d(o,v)}}const g=f=>{let o=!1;f&&typeof k=="object"&&typeof k._xAppSdk>"u"&&(k._xAppSdk=f,o=!0);const v=k==null?void 0:k._xAppSdk;return v&&o&&console.log("xAppSdk attached to window"),v};class l{constructor(){if(this.xummEnvironment={version:"",ott:""},!(typeof window>"u"||typeof document>"u")){if(typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"){const o=navigator.userAgent.trim().match(/xumm\/xapp:([0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}).*ott:([0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12})/);o&&(this.xummEnvironment.version=o[1],this.xummEnvironment.ott=o[2])}this.xummEnvironment.version===""&&console.log("Warning: Xumm Version could not be retrieved from User Agent, possibly not loaded in xApp context?"),g()||g(new w)}}getEnvironment(){return this.xummEnvironment}on(o,v){const A=g();if(A)return A.on(o,v),this}off(o,v){const A=g();if(A)return A.off(o,v),this}navigate(o){const v=g();if(v)return v.navigate(o)}openSignRequest(o){const v=g();if(v&&o!=null&&o.uuid)return v.openSignRequest(o)}selectDestination(o){const v=g();if(v)return v.selectDestination(o)}openBrowser(o){const v=g();if(v)return v.openBrowser(o)}share(o){const v=g();if(v)return v.share(o)}scanQr(){const o=g();if(o)return o.scanQr()}tx(o){const v=g();if(v)return v.tx(o)}close(o){const v=g();if(v)return v.close(o)}ready(){const o=g();if(o)return o.ready()}customCommand(o,v){const A=g();if(A)return A.customCommand(o,v)}}n.xApp=l}(Xe)),Xe}var jr={},re=j&&j.__awaiter||function(n,e,t,r){function c(u){return u instanceof t?u:new t(function(p){p(u)})}return new(t||(t=Promise))(function(u,p){function y(s){try{i(r.next(s))}catch(_){p(_)}}function m(s){try{i(r.throw(s))}catch(_){p(_)}}function i(s){s.done?u(s.value):c(s.value).then(y,m)}i((r=r.apply(n,e||[])).next())})};Object.defineProperty(Ue,"__esModule",{value:!0});var Or=Ue.Xumm=void 0;const Rr=ue,Cr=it,Jr=Ie,Ze=n=>Cr.Buffer.from(n,"base64").toString("utf8");var et;(function(n){n.cli="cli",n.browser="browser",n.xapp="xapp"})(et||(et={}));const $={cli:!1,browser:!1,xapp:!1},he=new RegExp("^[0-9(a-f|A-F)]{8}-[0-9(a-f|A-F)]{4}-4[0-9(a-f|A-F)]{3}-[89ab][0-9(a-f|A-F)]{3}-[0-9(a-f|A-F)]{12}$"),x={},xe=typeof process=="object"&&process?(process==null?void 0:jr)||{}:{};Object.assign($,{cli:Object.keys(xe).indexOf("NODE")>-1||Object.keys(xe).indexOf("SHELL")>-1||Object.keys(xe).indexOf("TERM")>-1||Object.keys(xe).indexOf("PATH")>-1});Object.assign($,{browser:typeof process=="object"&&process&&(process==null?void 0:process.browser)||typeof document=="object"&&document&&(document==null?void 0:document.location)});Object.assign($,{xapp:$.browser&&(!!navigator.userAgent.match(/xumm\/xapp/i)||!!navigator.userAgent.match(/xAppBuilder/i))});const Xr=Object.keys($).filter(n=>$[n]),Q=[],B=n=>re(void 0,void 0,void 0,function*(){return yield Promise.all(Q),yield n()}),ve=n=>new Proxy(n,{get(e,t){return["on","off"].indexOf(String(t))<0&&(typeof e[t]=="function"||e.constructor.name==="Promise")?function(){return e.constructor.name==="Promise"?e.then(r=>B(()=>r[t](...arguments))):B(()=>e[t](...arguments))}:e[t]}}),ne={XummSdk:!1,XummSdkJwt:!1,XummPkce:!1,xApp:!1};let T,q="",F={},E={},tt=0;class rt{constructor(){this.account=B(()=>{var e,t,r;return(t=(e=F==null?void 0:F.sub)!==null&&e!==void 0?e:E==null?void 0:E.sub)!==null&&t!==void 0?t:(r=T==null?void 0:T.account_info)===null||r===void 0?void 0:r.account}),this.picture=B(()=>{var e,t,r,c,u,p,y;return(e=E==null?void 0:E.picture)!==null&&e!==void 0?e:((r=(t=F==null?void 0:F.sub)!==null&&t!==void 0?t:E==null?void 0:E.sub)!==null&&r!==void 0?r:!((c=T==null?void 0:T.account_info)===null||c===void 0)&&c.account)?`https://xumm.app/avatar/${(p=(u=F==null?void 0:F.sub)!==null&&u!==void 0?u:E==null?void 0:E.sub)!==null&&p!==void 0?p:(y=T==null?void 0:T.account_info)===null||y===void 0?void 0:y.account}.png`:void 0}),this.name=B(()=>{var e,t;return(e=E==null?void 0:E.name)!==null&&e!==void 0?e:(t=T==null?void 0:T.account_info)===null||t===void 0?void 0:t.name}),this.domain=B(()=>{var e,t;return(e=E==null?void 0:E.domain)!==null&&e!==void 0?e:(t=T==null?void 0:T.account_info)===null||t===void 0?void 0:t.domain}),this.source=B(()=>{var e,t;return(e=E==null?void 0:E.source)!==null&&e!==void 0?e:(t=T==null?void 0:T.account_info)===null||t===void 0?void 0:t.source}),this.networkType=B(()=>{var e,t;return(t=(e=E==null?void 0:E.networkType)!==null&&e!==void 0?e:F.network_type)!==null&&t!==void 0?t:T==null?void 0:T.nodetype}),this.networkEndpoint=B(()=>{var e,t;return(t=(e=E==null?void 0:E.networkEndpoint)!==null&&e!==void 0?e:F.network_endpoint)!==null&&t!==void 0?t:T==null?void 0:T.nodewss}),this.networkId=B(()=>{var e,t;return(t=(e=E==null?void 0:E.networkId)!==null&&e!==void 0?e:F.network_id)!==null&&t!==void 0?t:T==null?void 0:T.networkid}),this.blocked=B(()=>{var e,t;return(e=E==null?void 0:E.blocked)!==null&&e!==void 0?e:(t=T==null?void 0:T.account_info)===null||t===void 0?void 0:t.blocked}),this.kycApproved=B(()=>{var e,t;return(e=E==null?void 0:E.kycApproved)!==null&&e!==void 0?e:(t=T==null?void 0:T.account_info)===null||t===void 0?void 0:t.kycApproved}),this.proSubscription=B(()=>{var e,t;return(e=E==null?void 0:E.proSubscription)!==null&&e!==void 0?e:(t=T==null?void 0:T.account_info)===null||t===void 0?void 0:t.proSubscription}),this.profile=B(()=>{var e,t,r;return(e=E==null?void 0:E.profile)!==null&&e!==void 0?e:!((r=(t=T==null?void 0:T.account_info)===null||t===void 0?void 0:t.profile)===null||r===void 0)&&r.slug?T.account_info.profile:void 0}),this.token=B(()=>{var e;return(e=F==null?void 0:F.usertoken_uuidv4)!==null&&e!==void 0?e:null})}}class Br extends Jr.EventEmitter{constructor(e,t){var r,c,u,p;super(),this.instance="0",this.jwtCredential=!1,this.runtime=$,this.apiKeyOrJwt="",this.apiKeyOrJwt=e,this.apiSecretOrOtt=t,tt++,this.instance=String(tt),typeof(console==null?void 0:console.log)<"u"&&($.cli||console.log("Constructed Xumm",{runtime:Xr}));let y=!1;if(typeof this.apiKeyOrJwt=="string"&&this.apiKeyOrJwt.split(".").length===3){let i;try{i=JSON.parse(Ze((r=this.apiKeyOrJwt.split("."))===null||r===void 0?void 0:r[1]))}catch{}if(Date.now()>=i.exp*1e3){y=!0;const s=(p=(u=(c=i==null?void 0:i.app_uuidv4)!==null&&c!==void 0?c:i==null?void 0:i.client_id)!==null&&u!==void 0?u:i==null?void 0:i.aud)!==null&&p!==void 0?p:"";if(this.apiKeyOrJwt=s,$.cli||console.log("JWT expired, falling back to API KEY: "+s),$.cli||$.xapp){const _=new Error("JWT Expired, cannot fall back to API credential: in CLI/xApp environment");throw this.emit("error",_),_}}y||(this.jwtCredential=!0,q=this.apiKeyOrJwt)}this.initialize(),this.user=new rt,this.environment={jwt:B(()=>F),ott:B(()=>T),openid:B(()=>E),bearer:B(()=>q),ready:new Promise(i=>this.on("ready",()=>i(void 0))),success:new Promise(i=>this.on("success",()=>i(void 0))),retrieved:new Promise(i=>this.on("retrieved",()=>i(void 0))),retrieving:new Promise(i=>this.on("retrieving",()=>i(void 0)))},this.helpers=ve(B(()=>x.XummSdk||x.XummSdkJwt)),this.push=ve(B(()=>(x.XummSdk||x.XummSdkJwt).Push)),this.payload=ve(B(()=>(x.XummSdk||x.XummSdkJwt).payload)),this.userstore=ve(B(()=>(x.XummSdk||x.XummSdkJwt).jwtUserdata)),this.backendstore=ve(B(()=>(x.XummSdk||x.XummSdkJwt).storage));const m=x==null?void 0:x.xApp;m&&(this.xapp=m),setTimeout(()=>Promise.all([...Q.filter(i=>(i==null?void 0:i.promiseType)!=="pkceRetrieverResolver"),$.xapp?Promise.resolve():new Promise(i=>{var s;x!=null&&x.XummPkce?(this.user.account.then(()=>i()),(s=x.XummPkce)===null||s===void 0||s.on("loggedout",()=>i())):i()})]).then(()=>this.emit("ready")),0)}initialize(){T=void 0,typeof this.apiKeyOrJwt=="string"&&this.apiKeyOrJwt.split(".").length===3&&q===this.apiKeyOrJwt||(q="",F={}),E={},ne.XummSdkJwt=!1;const e=()=>re(this,void 0,void 0,function*(){x!=null&&x.xApp&&(ne.xApp=!0,x.xApp.on("qr",c=>{this.emit("qr",c,this.instance)}),x.xApp.on("payload",c=>{this.emit("payload",c,this.instance)}),x.xApp.on("networkswitch",c=>{this.emit("networkswitch",c,this.instance)}),x.xApp.on("destination",c=>{this.emit("destination",c,this.instance)}))});this.handlePkceEvents();const t=()=>re(this,void 0,void 0,function*(){var c;if(x!=null&&x.XummSdkJwt&&!ne.XummSdkJwt){ne.XummSdkJwt=!0;const u=this.jwtCredential||q!=="";u||(Q.push(x.XummSdkJwt.getOttData()),Q.push(x.XummSdkJwt.getJwt()));const p=u?null:yield x.XummSdkJwt.getOttData(),y=u?q:yield x.XummSdkJwt.getJwt();if(p&&(T=p,this.emit("retrieved"),this.emit("success")),y){q=y;try{F=JSON.parse(Ze((c=q.split("."))===null||c===void 0?void 0:c[1])),u&&this.jwtCredential&&(setTimeout(()=>this.emit("retrieved"),0),setTimeout(()=>this.emit("success"),0))}catch(m){typeof(console==null?void 0:console.log)<"u"&&($.cli||console.log("Error decoding JWT",(m==null?void 0:m.message)||""))}}}}),r=()=>{var c,u,p;x!=null&&x.XummSdkJwt||(Object.assign(x,{XummSdkJwt:new(ke()).XummSdkJwt(this.apiKeyOrJwt,typeof((c=x==null?void 0:x.xApp)===null||c===void 0?void 0:c.getEnvironment)<"u"&&((p=(u=x==null?void 0:x.xApp)===null||u===void 0?void 0:u.getEnvironment())===null||p===void 0?void 0:p.ott)||void 0)}),Q.push(t()))};if($.xapp){if(typeof this.apiKeyOrJwt!="string"||!(he.test(this.apiKeyOrJwt)||this.jwtCredential))throw new Error("Running in xApp, constructor requires first param. to be Xumm API Key or JWT");x!=null&&x.xApp||Object.assign(x,{xApp:new(Tr()).xApp}),Q.push(e()),r()}else if($.browser){if(typeof this.apiKeyOrJwt!="string"||!(he.test(this.apiKeyOrJwt)||this.jwtCredential))throw new Error("Running in browser, constructor requires first param. to be Xumm API Key or JWT");if(!(x!=null&&x.XummPkce)&&!$.xapp&&(Object.assign(x,{XummPkce:new Rr.XummPkce(this.apiKeyOrJwt,{implicit:!0})}),x.XummPkce))if(this.jwtCredential)r();else{setTimeout(()=>this.emit("retrieving"),0);const c=p=>{var y,m;(m=(y=x.XummPkce)===null||y===void 0?void 0:y.state())===null||m===void 0||m.then(i=>{i!=null&&i.sdk&&!(x!=null&&x.XummSdkJwt)&&(Object.assign(x,{XummSdkJwt:i.sdk}),Object.assign(E,Object.assign({},(i==null?void 0:i.me)||{}))),i!=null&&i.jwt&&q===""&&(q=i.jwt,t()),p(i)})};Q.push(this.handlePkceEvents());const u=new Promise(p=>{var y,m;(y=x.XummPkce)===null||y===void 0||y.on("retrieved",()=>{c(p)}),(m=x.XummPkce)===null||m===void 0||m.on("success",()=>{c(p)})});Q.push(Object.assign(u,{promiseType:"pkceRetrieverResolver"}))}}else if($.cli){if(typeof this.apiKeyOrJwt!="string")throw new Error("Running CLI, constructor needs first param. to be Xumm API Key / raw JWT");if(he.test(this.apiKeyOrJwt)&&(typeof this.apiSecretOrOtt!="string"||!he.test(this.apiSecretOrOtt)))throw new Error("Running CLI, constructor first param. is API Key, but second param. isn't a valid API Secret");if(!he.test(this.apiKeyOrJwt)&&this.apiKeyOrJwt.split(".").length!==3)throw new Error("Running CLI, constructor first param. not a valid JWT, nor a valid API Key");this.jwtCredential?r():x!=null&&x.XummSdk||Object.assign(x,{XummSdk:new(ke()).XummSdk(this.apiKeyOrJwt,this.apiSecretOrOtt)})}}authorize(){var e;return re(this,void 0,void 0,function*(){try{return yield(e=x==null?void 0:x.XummPkce)===null||e===void 0?void 0:e.authorize()}catch(t){return t}})}handlePkceEvents(){return re(this,void 0,void 0,function*(){if(x!=null&&x.XummPkce&&!ne.XummPkce){ne.XummPkce=!0;const e=()=>this.emit("retrieved"),t=()=>this.emit("success"),r=c=>this.emit("error",c);x.XummPkce.on("retrieved",e),x.XummPkce.on("success",t),x.XummPkce.on("error",r)}})}logout(){var e;return re(this,void 0,void 0,function*(){if($.xapp)return;let t=!1;typeof this.apiKeyOrJwt=="string"&&this.apiKeyOrJwt.split(".").length===3&&(F!=null&&F.app_uuidv4)&&this.jwtCredential&&(this.apiKeyOrJwt=F.app_uuidv4,this.jwtCredential=!1,t=!0,window._XummPkce=void 0),$.browser&&(E!=null&&E.sub||t)&&((e=x==null?void 0:x.XummPkce)===null||e===void 0||e.logout(),Object.assign(x,{XummSdk:void 0,XummSdkJwt:void 0,XummPkce:void 0}),Q.length=0,this.jwtCredential=!1,this.initialize(),this.user=new rt,this.environment={jwt:B(()=>F),ott:B(()=>T),openid:B(()=>E),bearer:B(()=>q),ready:new Promise(r=>this.on("ready",()=>r(void 0))),success:new Promise(r=>this.on("success",()=>r(void 0))),retrieved:new Promise(r=>this.on("retrieved",()=>r(void 0))),retrieving:new Promise(r=>this.on("retrieving",()=>r(void 0)))},this.emit("logout"))})}ping(){var e;return re(this,void 0,void 0,function*(){return yield Promise.all(Q),(e=(x==null?void 0:x.XummSdkJwt)||(x==null?void 0:x.XummSdk))===null||e===void 0?void 0:e.ping()})}}Or=Ue.Xumm=Br;const Mr={xummFetching:!1,fetchXummErrorMsg:""},dt=ht({name:"xumm",initialState:Mr,reducers:{xummAuthorize:n=>{n.xummFetching=!0},xummAuthorizeSuccess:n=>{n.xummFetching=!1},xummAuthorizeFailure:(n,e)=>{n.xummFetching=!1,n.fetchXummErrorMsg=e.payload},fetchCurrentRecipient:{reducer:n=>{n.xummFetching=!0},prepare:n=>({payload:n})},fetchCurrentRecipientSuccess:n=>{n.xummFetching=!1},fetchCurrentRecipientFailure:(n,e)=>{n.xummFetching=!1,n.fetchXummErrorMsg=e.payload}}}),ae=dt.actions,Qr=dt.reducer;let De;function*Dr(){try{const n=""}catch(n){n instanceof Error&&(yield se(ae.xummAuthorizeFailure(n.message))),console.error(n)}}function*Ir(){try{yield vt(ae.xummAuthorizeSuccess),yield ot([Se(Lr),Se(Ur)])}catch(n){console.error(n)}}function*Ur(){yield pt([ye.agreeLinkClicked,ye.memoLinkClicked,ye.supportLinkClicked,ye.rateUsLinkClicked],Fr)}function*Fr(n){try{De.xapp&&(yield Se([De.xapp,"openBrowser"],{url:n.payload}))}catch(e){console.error(e)}}function*Lr(){yield mt(_t.fetchRates,Wr)}function*Wr(){try{yield se(ae.fetchCurrentRecipient());const n=yield De.user.account;n?(yield se(bt.setWithdrawalAddress(n)),yield se(ae.fetchCurrentRecipientSuccess())):yield se(ae.fetchCurrentRecipientFailure("No address"))}catch(n){n instanceof Error&&(yield se(ae.fetchCurrentRecipientFailure(n.message))),console.error(n)}}function*Yr(){try{yield ot([Se(Dr),wt(Ir)])}catch(n){console.error(n)}}export{Qr as xummReducer,Yr as xummSaga};
